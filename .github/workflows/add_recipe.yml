name: Add recipe PR from issue
on:
  issues:
    types: [labeled]

jobs:
  create-pr:
    if: github.event.label.name == 'recipe'
    runs-on: ubuntu-latest
    steps:
      - name: Create Environment Variables ğŸŒ
        run: |
          echo "BRANCH_NAME=$( echo '${{ github.event.issue.title }}' | tr '[:upper:]' '[:lower:]' | tr ' ' '-')" >> $GITHUB_ENV
          echo "FILE_PATH=_recipes/$( echo '${{ github.event.issue.title }}' | tr '[:upper:]' '[:lower:]' | tr ' ' '_' ).md" >> $GITHUB_ENV
      - name: Create branch ğŸŒµ
        uses: peterjgrainger/action-create-branch@v2.0.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          branch: ${{ env.BRANCH_NAME }}
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2.3.1
        with:
          ref: ${{ env.BRANCH_NAME }}
      - name: Create Recipe ğŸ²
        env:
          RECIPE: ${{ github.event.issue.body }}
        run: python3 save_recipe_from_env.py
      - name: Add & Commit & Push ğŸ“¤
        uses: EndBug/add-and-commit@v7
        with:
          author_name: Recipe Action
          author_email: ci@summit.cooking
          message: 'Add recipe: ${{ github.event.issue.title }}'
          add: ${{ env.FILE_PATH }}
          branch: ${{ env.BRANCH_NAME }}
      - name: Create PR âœ¨
        id: cpr
        uses: peter-evans/create-pull-request@v3
        with:
          branch: ${{ env.BRANCH_NAME }}
